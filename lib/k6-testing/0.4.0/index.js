import Re from"k6/execution";function C(t,e,r){if(!t){if(r)throw new V(e);Re.test.abort(e)}}var V=class extends Error{constructor(e){super(e),this.name="AssertionFailedError"}};function ke(){return typeof Deno<"u"?Deno.env.toObject():__ENV}var G=ke(),E={hasValue(t){return G[t]!==void 0},boolean(t){let e=G[t]?.toLowerCase();if(e===void 0)throw new Error(`Environment variable ${t} is not set`);return e!=="false"},enum(t,e){let r=G[t]?.toLowerCase();if(r===void 0)throw new Error(`Environment variable ${t} is not set`);if(!e.includes(r))throw new Error(`Invalid value for ${t}. Must be one of: ${e.join(", ")}`);return r},number(t){let e=G[t];if(!e)throw new Error(`Environment variable ${t} is not set`);let r=Number(e);if(Number.isNaN(r)||!Number.isFinite(r))throw new Error(`Environment variable ${t} must be a valid number, got: ${e}`);if(r<0)throw new Error(`Environment variable ${t} must be a non-negative number, got: ${e}`);return r}};var _={timeout:5e3,interval:100},Ce={..._,soft:!1,colorize:!0,display:"pretty",assertFn:C},A=class t{static load(e={}){let r=t.loadFromEnv();return{...Ce,...e,...r}}static loadFromEnv(){let e={};return E.hasValue("K6_TESTING_COLORIZE")&&(e.colorize=E.boolean("K6_TESTING_COLORIZE")),E.hasValue("K6_TESTING_DISPLAY")&&(e.display=E.enum("K6_TESTING_DISPLAY",["inline","pretty"])),E.hasValue("K6_TESTING_TIMEOUT")&&(e.timeout=E.number("K6_TESTING_TIMEOUT")),E.hasValue("K6_TESTING_INTERVAL")&&(e.interval=E.number("K6_TESTING_INTERVAL")),e}};function N(t){if(!t||t.length<=1)return;let e=t[t.length-1],r=e.filePath,n=e.fileName,s=e.lineNumber,i=e.columnNumber,a=`${r}:${s}:${i}`;return{filePath:r,fileName:n,lineNumber:s,columnNumber:i,at:a}}function L(t){if(!t)return[];let e=t.split(`
`),r=[];for(let n=0;n<e.length;n++){let s=e[n].trim();if(n===0&&s.startsWith("Error")||!s.startsWith("at "))continue;s=s.slice(3).trim();let i="<anonymous>",a=s,o=s.indexOf("("),l=s.indexOf("file://");l===0?(i="<anonymous>",a=s.slice(l)):o>=0?(i=s.slice(0,o).trim()||"<anonymous>",a=s.slice(o+1,s.lastIndexOf(")")).trim()):a=s;let u=a.lastIndexOf("(");u>=0&&(a=a.slice(0,u)),a.startsWith("file://")&&(a=a.slice(7));let p=a.lastIndexOf(":");if(p===-1)continue;let d=a.lastIndexOf(":",p-1);if(d===-1)continue;let b=a.slice(0,d),x=b.split("/").pop()??"",y=a.slice(d+1,p),S=a.slice(p+1);r.push({functionName:i,filePath:b,fileName:x,lineNumber:parseInt(y,10),columnNumber:parseInt(S,10)})}return r}var Ee={reset:"\x1B[0m",black:"\x1B[30m",red:"\x1B[31m",green:"\x1B[32m",yellow:"\x1B[33m",blue:"\x1B[34m",magenta:"\x1B[35m",cyan:"\x1B[36m",white:"\x1B[37m",brightBlack:"\x1B[90m",brightRed:"\x1B[91m",brightGreen:"\x1B[92m",brightYellow:"\x1B[93m",brightBlue:"\x1B[94m",brightMagenta:"\x1B[95m",brightCyan:"\x1B[96m",brightWhite:"\x1B[97m",darkGrey:"\x1B[90m"};function O(t,e){return`${Ee[e]}${t}${Ee.reset}`}var c=class{static renderers=new Map;static config={colorize:!0,display:"pretty"};static register(e,r){this.renderers.set(e,r)}static getRenderer(e){return this.renderers.get(e)||new T}static configure(e){this.config={...this.config,...e}}static getConfig(){return this.config}},F=class{getReceivedPlaceholder(){return"received"}getExpectedPlaceholder(){return"expected"}renderErrorLine(e,r){let n=(s,i)=>r.colorize?O(s,i):s;return"customMessage"in e&&typeof e.customMessage=="string"?n(e.customMessage,"white"):n("expect(","darkGrey")+n(this.getReceivedPlaceholder(),"red")+n(").","darkGrey")+n(this.getMatcherName(),"white")+this.renderMatcherArgs(n)}renderMatcherArgs(e){return e("()","darkGrey")}render(e,r){let n=(i,a)=>r.colorize?O(i,a):i,s=[{label:"Error",value:this.renderErrorLine(e,r),group:1},{label:"At",value:n(e.executionContext.at||"unknown location","darkGrey"),group:1},...this.getSpecificLines(e,n),{label:"Filename",value:n(e.executionContext.fileName,"darkGrey"),group:99},{label:"Line",value:n(e.executionContext.lineNumber.toString(),"darkGrey"),group:99}];return $.getFormatter(r.display).renderLines(s)}},m=class extends F{getSpecificLines(e,r){return[{label:"Received",value:r(e.received,"red"),group:2}]}},f=class extends F{getSpecificLines(e,r){return[{label:"Expected",value:r(e.expected,"green"),group:2},{label:"Received",value:r(e.received,"red"),group:2}]}renderMatcherArgs(e){return e("(","darkGrey")+e(this.getExpectedPlaceholder(),"green")+e(")","darkGrey")}},T=class{render(e,r){let n=(i,a)=>r.colorize?O(i,a):i,s=[{label:"Error",value:this.renderErrorLine(e,r),group:1},{label:"At",value:n(e.executionContext.at||"unknown location","darkGrey"),group:1},{label:"Expected",value:n(e.expected,"green"),group:2},{label:"Received",value:n(e.received,"red"),group:2},{label:"Filename",value:n(e.executionContext.fileName,"darkGrey"),group:3},{label:"Line",value:n(e.executionContext.lineNumber.toString(),"darkGrey"),group:3}];return $.getFormatter(r.display).renderLines(s)}renderErrorLine(e,r){let n=(s,i)=>r.colorize?O(s,i):s;return n("expect(","darkGrey")+n("received","red")+n(").","darkGrey")+n(`${e.matcherName}`,"white")+n("(","darkGrey")+n("expected","green")+n(")","darkGrey")}},q=class{renderLines(e){let r=Math.max(...e.filter(n=>!n.raw).map(({label:n})=>(n+":").length));return`

`+e.map(({label:n,value:s,raw:i},a)=>{let o;if(i)o=s;else{let u=n+":";o=" ".repeat(r-u.length)+u+" "+s}let l=e[a+1];return l&&e[a].group!==l.group?o+`
`:o}).join(`
`)+`

`}},j=class{renderLines(e){return e.map(({label:r,value:n})=>{let s=typeof n=="string"&&n.includes(" ")?`"${n}"`:n;return`${r.toLowerCase().replace(/\s+/g,"_")}=${s}`}).join(" ")}},$=class{static formatters=new Map([["pretty",new q],["inline",new j]]);static getFormatter(e){let r=this.formatters.get(e);if(!r)throw new Error(`Unknown display format: ${e}`);return r}};function D(t,e,r,n=!1){let s=e.assertFn??C;c.configure({colorize:e.colorize,display:e.display}),c.register("toBe",new T),c.register("toBeCloseTo",new U),c.register("toBeDefined",new J),c.register("toBeFalsy",new K),c.register("toBeGreaterThan",new W),c.register("toBeGreaterThanOrEqual",new Y),c.register("toBeInstanceOf",new Z),c.register("toBeLessThan",new Q),c.register("toBeLessThanOrEqual",new X),c.register("toBeNaN",new z),c.register("toBeNull",new ee),c.register("toBeTruthy",new te),c.register("toBeUndefined",new re),c.register("toEqual",new ne),c.register("toHaveLength",new oe),c.register("toContain",new ie),c.register("toContainEqual",new ae),c.register("toHaveProperty",new se);let i={usedAssert:s,isSoft:e.soft,isNegated:n,message:r};return{get not(){return D(t,e,r,!n)},toBe(o){g("toBe",()=>Object.is(t,o),o,t,i)},toBeCloseTo(o,l=2){let u=Math.pow(10,-l)*Math.max(Math.abs(t),Math.abs(o)),p=Math.abs(t-o);g("toBeCloseTo",()=>p<u,o,t,{...i,matcherSpecific:{precision:l,difference:p,expectedDifference:u}})},toBeDefined(){g("toBeDefined",()=>t!==void 0,"defined",JSON.stringify(t),i)},toBeFalsy(){g("toBeFalsy",()=>!t,"falsy",JSON.stringify(t),i)},toBeGreaterThan(o){g("toBeGreaterThan",()=>t>o,o,t,i)},toBeGreaterThanOrEqual(o){g("toBeGreaterThanOrEqual",()=>t>=o,o,t,i)},toBeInstanceOf(o){g("toBeInstanceOf",()=>t instanceof o,o.name,t.constructor.name,i)},toBeLessThan(o){g("toBeLessThan",()=>t<o,o,t,i)},toBeLessThanOrEqual(o){g("toBeLessThanOrEqual",()=>t<=o,o,t,i)},toBeNaN(){g("toBeNaN",()=>isNaN(t),"NaN",JSON.stringify(t),i)},toBeNull(){g("toBeNull",()=>t===null,"null",JSON.stringify(t),i)},toBeTruthy(){g("toBeTruthy",()=>!!t,"truthy",JSON.stringify(t),i)},toBeUndefined(){g("toBeUndefined",()=>t===void 0,"undefined",JSON.stringify(t),i)},toEqual(o){g("toEqual",()=>P(t,o),JSON.stringify(o),JSON.stringify(t),i)},toHaveLength(o){g("toHaveLength",()=>t.length===o,o.toString(),t.length.toString(),i)},toContain(o){let l="";if(typeof t=="string")l="string";else if(Array.isArray(t))l="array";else if(t instanceof Set)l="set";else throw new Error("toContain is only supported for strings, arrays, and sets");g("toContain",()=>{if(typeof t=="string")return t.includes(o);if(Array.isArray(t))return t.includes(o);if(t instanceof Set)return Array.from(t).includes(o);throw new Error("toContain is only supported for strings, arrays, and sets")},o,t,{...i,matcherSpecific:{receivedType:l}})},toContainEqual(o){let l="";if(Array.isArray(t))l="array";else if(t instanceof Set)l="set";else throw new Error("toContainEqual is only supported for arrays and sets");g("toContainEqual",()=>{if(Array.isArray(t))return t.some(u=>P(u,o));if(t instanceof Set)return Array.from(t).some(u=>P(u,o));throw new Error("toContainEqual is only supported for arrays and sets")},o,t,{...i,matcherSpecific:{receivedType:l}})},toHaveProperty(o,l){if(typeof t!="object"||t===null)throw new Error("toHaveProperty is only supported for objects");g("toHaveProperty",()=>{try{let p=Le(t,o);return l!==void 0?P(p,l):!0}catch{return!1}},l!==void 0?l:o,t,{...i,matcherSpecific:{keyPath:o,hasExpectedValue:l!==void 0}})}}}function g(t,e,r,n,{usedAssert:s,isSoft:i,isNegated:a=!1,matcherSpecific:o={},message:l}){let u=Ne(t,r,n,{...o,isNegated:a},l),p=e();s(a?!p:p,c.getRenderer(t).render(u,c.getConfig()),i)}function Ne(t,e,r,n={},s){let i=L(new Error().stack),a=N(i);if(!a)throw new Error("k6 failed to capture execution context");return{executionContext:a,matcherName:t,expected:typeof e=="string"?e:JSON.stringify(e),received:JSON.stringify(r),matcherSpecific:n,customMessage:s}}var U=class extends f{getMatcherName(){return"toBeCloseTo"}getSpecificLines(e,r){let n=e.matcherSpecific;return[{label:"Expected precision",value:r(n.precision.toString(),"green"),group:3},{label:"Expected difference",value:"< "+r(`${n.expectedDifference}`,"green"),group:3},{label:"Received difference",value:r(n.difference.toString(),"red"),group:3}]}renderMatcherArgs(e){return e("(","darkGrey")+e("expected","green")+e(", ","darkGrey")+e("precision","white")+e(")","darkGrey")}},J=class extends m{getMatcherName(){return"toBeDefined"}},K=class extends m{getMatcherName(){return"toBeFalsy"}},W=class extends f{getMatcherName(){return"toBeGreaterThan"}getSpecificLines(e,r){return[{label:"Expected",value:"> "+r(e.expected,"green"),group:3},{label:"Received",value:r(e.received,"red"),group:3}]}},Y=class extends f{getMatcherName(){return"toBeGreaterThanOrEqual"}getSpecificLines(e,r){return[{label:"Expected",value:">= "+r(e.expected,"green"),group:3},{label:"Received",value:r(e.received,"red"),group:3}]}},Z=class extends f{getMatcherName(){return"toBeInstanceOf"}getSpecificLines(e,r){return[{label:"Expected constructor",value:r(e.expected,"green"),group:3},{label:"Received constructor",value:r(e.received,"red"),group:3}]}},Q=class extends f{getMatcherName(){return"toBeLessThan"}getSpecificLines(e,r){return[{label:"Expected",value:"< "+r(e.expected,"green"),group:3},{label:"Received",value:r(e.received,"red"),group:3}]}},X=class extends f{getMatcherName(){return"toBeLessThanOrEqual"}getSpecificLines(e,r){return[{label:"Expected",value:"<= "+r(e.expected,"green"),group:3},{label:"Received",value:r(e.received,"red"),group:3}]}},z=class extends m{getMatcherName(){return"toBeNaN"}},ee=class extends m{getMatcherName(){return"toBeNull"}},te=class extends m{getMatcherName(){return"toBeTruthy"}},re=class extends m{getMatcherName(){return"toBeUndefined"}},ne=class extends f{getMatcherName(){return"toEqual"}getSpecificLines(e,r){return[{label:"Expected",value:r(e.expected,"green"),group:3},{label:"Received",value:r(e.received,"red"),group:3}]}},oe=class extends f{getMatcherName(){return"toHaveLength"}getSpecificLines(e,r){return[{label:"Expected length",value:r(e.expected,"green"),group:3},{label:"Received length",value:r(e.received,"red"),group:3},{label:"Received array",value:r(e.matcherSpecific?.receivedArray,"red"),group:3}]}},ie=class extends f{getMatcherName(){return"toContain"}getSpecificLines(e,r){let n=e.matcherSpecific?.isNegated,s=typeof e.matcherSpecific?.receivedType=="string"?e.matcherSpecific?.receivedType:Array.isArray(JSON.parse(e.received))?"array":"string";return[{label:n?"Expected not to contain":"Expected to contain",value:r(e.expected,"green"),group:3},{label:`Received ${s}`,value:r(e.received,"red"),group:3}]}},ae=class extends f{getMatcherName(){return"toContainEqual"}getSpecificLines(e,r){let n=e.matcherSpecific?.isNegated,s=e.matcherSpecific?.receivedType;return[{label:n?"Expected not to contain equal":"Expected to contain equal",value:r(e.expected,"green"),group:3},{label:`Received ${s}`,value:r(e.received,"red"),group:3}]}},se=class extends f{getMatcherName(){return"toHaveProperty"}getSpecificLines(e,r){let n=e.matcherSpecific?.isNegated,s=e.matcherSpecific?.keyPath,i=e.matcherSpecific?.hasExpectedValue,a=[{label:"Property path",value:r(s,"white"),group:3}];return i?a.push({label:n?"Expected property not to equal":"Expected property to equal",value:r(e.expected,"green"),group:3}):a.push({label:n?"Expected property not to exist":"Expected property to exist",value:"",group:3}),a.push({label:"Received object",value:r(e.received,"red"),group:3}),a}renderMatcherArgs(e){return e("(","darkGrey")+e("keyPath","white")+e(", ","darkGrey")+e("expected?","green")+e(")","darkGrey")}};function P(t,e){if(t===e)return!0;if(t===null||e===null||typeof t!="object"||typeof e!="object")return!1;let r=Object.keys(t),n=Object.keys(e);return r.length!==n.length?!1:r.every(s=>n.includes(s)&&P(t[s],e[s]))}function Le(t,e){if(e==="")throw new Error("Invalid path: empty string");let r=[],n="",s=!1;for(let a=0;a<e.length;a++){let o=e[a];if(o==="."&&!s)n&&(r.push(n),n="");else if(o==="[")n&&(r.push(n),n=""),s=!0;else if(o==="]")if(s)r.push(n),n="",s=!1;else throw new Error(`Invalid path: ${e}`);else n+=o}n&&r.push(n);let i=t;for(let a of r){if(i==null)throw new Error(`Property ${e} does not exist`);if(typeof a=="string"&&!isNaN(Number(a))){let o=Number(a);if(!Array.isArray(i))throw new Error(`Cannot access index ${a} of non-array`);if(o>=i.length)throw new Error(`Index ${a} out of bounds`);i=i[o]}else{if(typeof i!="object")throw new Error(`Cannot access property ${a} of non-object`);if(!Object.prototype.hasOwnProperty.call(i,a))throw new Error(`Property ${a} does not exist on object`);i=i[a]}}return i}function ce(t){return t.replace(/[\u200B\u00AD]/g,"").replace(/\s+/g," ").trim()}function H(t,e,r,n=!1){let s=e.assertFn??C,i=e.soft??!1,a={timeout:e.timeout,interval:e.interval};c.configure({colorize:e.colorize,display:e.display}),c.register("toBeChecked",new pe),c.register("toBeDisabled",new le),c.register("toBeEditable",new ue),c.register("toBeEnabled",new ge),c.register("toBeHidden",new de),c.register("toBeVisible",new fe),c.register("toHaveValue",new xe);let o={locator:t,retryConfig:a,usedAssert:s,isSoft:i,isNegated:n,message:r},l=(p,d)=>async function(x,y={}){let S=L(new Error().stack),w=N(S);if(!w)throw new Error("k6 failed to capture execution context");let he=(h,R)=>{let k=y.ignoreCase!==void 0?new RegExp(h.source,h.flags.replace("i","")+(y.ignoreCase?"i":"")):h,M={executionContext:w,matcherName:p,expected:k.toString(),received:R,matcherSpecific:{isNegated:n},customMessage:r},B=k.test(R);s(n?!B:B,c.getRenderer(p).render(M,c.getConfig()),i)},Se=(h,R)=>{let k=ce(h),M=ce(R),B={executionContext:w,matcherName:p,expected:k,received:M,matcherSpecific:{isNegated:n},customMessage:r},be=y.ignoreCase?d(M.toLowerCase(),k.toLowerCase()):d(M,k);s(n?!be:be,c.getRenderer(p).render(B,c.getConfig()),i)};try{await me(async()=>{let h=y.useInnerText?await t.innerText():await t.textContent();if(h===null)throw new Error("Element has no text content");if(x instanceof RegExp){he(x,h);return}Se(x,h)},{...a,...y})}catch{let R={executionContext:w,matcherName:p,expected:x.toString(),received:"unknown",matcherSpecific:{isNegated:n},customMessage:r};s(!1,c.getRenderer("toHaveText").render(R,c.getConfig()),i)}};return{get not(){return H(t,e,r,!n)},async toBeChecked(p=a){await I("toBeChecked",async()=>await t.isChecked(),"checked","unchecked",{...o,options:p})},async toBeDisabled(p=a){await I("toBeDisabled",async()=>await t.isDisabled(),"disabled","enabled",{...o,options:p})},async toBeEditable(p=a){await I("toBeEditable",async()=>await t.isEditable(),"editable","uneditable",{...o,options:p})},async toBeEnabled(p=a){await I("toBeEnabled",async()=>await t.isEnabled(),"enabled","disabled",{...o,options:p})},async toBeHidden(p=a){await I("toBeHidden",async()=>await t.isHidden(),"hidden","visible",{...o,options:p})},async toBeVisible(p=a){await I("toBeVisible",async()=>await t.isVisible(),"visible","hidden",{...o,options:p})},toHaveText:l("toHaveText",(p,d)=>p===d),toContainText:l("toContainText",(p,d)=>p.includes(d)),async toHaveValue(p,d=a){let b=L(new Error().stack),x=N(b);if(!x)throw new Error("k6 failed to capture execution context");let y={executionContext:x,matcherName:"toHaveValue",expected:p,received:"unknown",matcherSpecific:{isNegated:n},customMessage:r};try{await me(async()=>{let S=await t.inputValue(),w=p===S;s(n?!w:w,c.getRenderer("toHaveValue").render(y,c.getConfig()),i)},{...a,...d})}catch{s(!1,c.getRenderer("toHaveValue").render(y,c.getConfig()),i)}}}}function Oe(t,e,r,n={},s){let i=L(new Error().stack),a=N(i);if(!a)throw new Error("k6 failed to capture execution context");return{executionContext:a,matcherName:t,expected:e,received:r,customMessage:s,...n}}async function I(t,e,r,n,{locator:s,retryConfig:i,usedAssert:a,isSoft:o,isNegated:l=!1,options:u={},message:p}){let d=Oe(t,r,n,{matcherSpecific:{locator:s,timeout:u.timeout,isNegated:l}},p);try{await me(async()=>{let b=await e(),x=l?!b:b;if(!x)throw new Error("matcher failed");a(x,c.getRenderer(t).render(d,c.getConfig()),o)},{...i,...u})}catch{a(!1,c.getRenderer(t).render(d,c.getConfig()),o)}}var v=class extends m{getMatcherName(){return`toBe${this.state[0].toUpperCase()}${this.state.slice(1)}`}getReceivedPlaceholder(){return"locator"}getSpecificLines(e,r){return[{label:"Expected",value:this.state,group:3},{label:"Received",value:this.oppositeState,group:3},{label:"Call log",value:"",group:3},{label:"",value:r(`  - expect.toBe${this.state[0].toUpperCase()}${this.state.slice(1)} with timeout ${e.matcherSpecific?.timeout}ms`,"darkGrey"),group:3,raw:!0},{label:"",value:r("  - waiting for locator","darkGrey"),group:3,raw:!0}]}},pe=class extends v{state="checked";oppositeState="unchecked"},le=class extends v{state="disabled";oppositeState="enabled"},ue=class extends v{state="editable";oppositeState="uneditable"},ge=class extends v{state="enabled";oppositeState="disabled"},de=class extends v{state="hidden";oppositeState="visible"},fe=class extends v{state="visible";oppositeState="hidden"},xe=class extends f{getMatcherName(){return"toHaveValue"}getSpecificLines(e,r){return[{label:"Expected",value:r(e.expected,"green"),group:3},{label:"Received",value:r(e.received,"red"),group:3},{label:"Call log",value:"",group:3},{label:"",value:r(`  - expect.toHaveValue with timeout ${e.matcherSpecific?.timeout}ms`,"darkGrey"),group:3,raw:!0},{label:"",value:r("  - waiting for locator","darkGrey"),group:3,raw:!0}]}};async function me(t,e={}){let r=e.timeout??_.timeout,n=e.interval??_.interval,s=e._now??(()=>Date.now()),i=e._sleep??(o=>new Promise(l=>setTimeout(l,o))),a=s();for(;s()-a<r;){try{return await t(),!0}catch{}await i(n)}throw new ye(`Expect condition not met within ${r}ms timeout`)}var ye=class extends Error{constructor(e){super(e),this.name="RetryTimeoutError"}};var Ie=we();function we(t){let e=A.load(t);return Object.assign(function(r,n){return ve(r)?H(r,e,n):D(r,e,n)},{soft(r,n){return ve(r)?H(r,{...e,soft:!0},n):D(r,{...e,soft:!0},n)},configure(r){return we(r)},get config(){return{...e}}})}function ve(t){if(!t||typeof t!="object")return!1;let e=["clear","isEnabled","isHidden","getAttribute","selectOption","press","type","dispatchEvent","dblclick","setChecked","isDisabled","focus","innerText","inputValue","check","isEditable","fill","textContent","hover","waitFor","click","uncheck","isChecked","isVisible","innerHTML","tap"],r=n=>e.every(s=>s in n);return t!=null&&typeof t=="object"&&r(t)}export{O as colorize,Ie as expect};
//# sourceMappingURL=index.js.map
