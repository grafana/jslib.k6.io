import ue from"k6/execution";function b(t,e,r){if(!t){if(r)throw new O(e);ue.test.abort(e)}}var O=class extends Error{constructor(e){super(e),this.name="AssertionFailedError"}};function de(){return typeof Deno<"u"?Deno.env.toObject():__ENV}var N=de(),x={hasValue(t){return N[t]!==void 0},boolean(t){let e=N[t]?.toLowerCase();if(e===void 0)throw new Error(`Environment variable ${t} is not set`);return e!=="false"},enum(t,e){let r=N[t]?.toLowerCase();if(r===void 0)throw new Error(`Environment variable ${t} is not set`);if(!e.includes(r))throw new Error(`Invalid value for ${t}. Must be one of: ${e.join(", ")}`);return r},number(t){let e=N[t];if(!e)throw new Error(`Environment variable ${t} is not set`);let r=Number(e);if(Number.isNaN(r)||!Number.isFinite(r))throw new Error(`Environment variable ${t} must be a valid number, got: ${e}`);if(r<0)throw new Error(`Environment variable ${t} must be a non-negative number, got: ${e}`);return r}};var L={timeout:5e3,interval:100},ge={...L,soft:!1,colorize:!0,display:"pretty",assertFn:b},R=class t{static load(e={}){let r=t.loadFromEnv();return{...ge,...e,...r}}static loadFromEnv(){let e={};return x.hasValue("K6_TESTING_COLORIZE")&&(e.colorize=x.boolean("K6_TESTING_COLORIZE")),x.hasValue("K6_TESTING_DISPLAY")&&(e.display=x.enum("K6_TESTING_DISPLAY",["inline","pretty"])),x.hasValue("K6_TESTING_TIMEOUT")&&(e.timeout=x.number("K6_TESTING_TIMEOUT")),x.hasValue("K6_TESTING_INTERVAL")&&(e.interval=x.number("K6_TESTING_INTERVAL")),e}};function v(t){if(!t||t.length<=1)return;let e=t[1],r=e.filePath,o=e.fileName,n=e.lineNumber,a=e.columnNumber,i=`${r}:${n}:${a}`;return{filePath:r,fileName:o,lineNumber:n,columnNumber:a,at:i}}function w(t){if(!t)return[];let e=t.split(`
`),r=[];for(let o=0;o<e.length;o++){let n=e[o].trim();if(o===0&&n.startsWith("Error")||!n.startsWith("at "))continue;n=n.slice(3).trim();let a="<anonymous>",i=n,c=n.indexOf("("),u=n.indexOf("file://");u===0?(a="<anonymous>",i=n.slice(u)):c>=0?(a=n.slice(0,c).trim()||"<anonymous>",i=n.slice(c+1,n.lastIndexOf(")")).trim()):i=n;let g=i.lastIndexOf("(");g>=0&&(i=i.slice(0,g)),i.startsWith("file://")&&(i=i.slice(7));let d=i.lastIndexOf(":");if(d===-1)continue;let y=i.lastIndexOf(":",d-1);if(y===-1)continue;let re=i.slice(0,y),ce=re.split("/").pop()??"",le=i.slice(y+1,d),pe=i.slice(d+1);r.push({functionName:a,filePath:re,fileName:ce,lineNumber:parseInt(le,10),columnNumber:parseInt(pe,10)})}return r}var ne={reset:"\x1B[0m",black:"\x1B[30m",red:"\x1B[31m",green:"\x1B[32m",yellow:"\x1B[33m",blue:"\x1B[34m",magenta:"\x1B[35m",cyan:"\x1B[36m",white:"\x1B[37m",brightBlack:"\x1B[90m",brightRed:"\x1B[91m",brightGreen:"\x1B[92m",brightYellow:"\x1B[93m",brightBlue:"\x1B[94m",brightMagenta:"\x1B[95m",brightCyan:"\x1B[96m",brightWhite:"\x1B[97m",darkGrey:"\x1B[90m"};function h(t,e){return`${ne[e]}${t}${ne.reset}`}var s=class{static renderers=new Map;static config={colorize:!0,display:"pretty"};static register(e,r){this.renderers.set(e,r)}static getRenderer(e){return this.renderers.get(e)||new S}static configure(e){this.config={...this.config,...e}}static getConfig(){return this.config}},C=class{getReceivedPlaceholder(){return"received"}getExpectedPlaceholder(){return"expected"}renderErrorLine(e,r){let o=(n,a)=>r.colorize?h(n,a):n;return o("expect(","darkGrey")+o(this.getReceivedPlaceholder(),"red")+o(").","darkGrey")+o(this.getMatcherName(),"white")+this.renderMatcherArgs(o)}renderMatcherArgs(e){return e("()","darkGrey")}render(e,r){let o=(a,i)=>r.colorize?h(a,i):a,n=[{label:"Error",value:this.renderErrorLine(e,r),group:1},{label:"At",value:o(e.executionContext.at||"unknown location","darkGrey"),group:1},...this.getSpecificLines(e,o),{label:"Filename",value:o(e.executionContext.fileName,"darkGrey"),group:99},{label:"Line",value:o(e.executionContext.lineNumber.toString(),"darkGrey"),group:99}];return k.getFormatter(r.display).renderLines(n)}},f=class extends C{getSpecificLines(e,r){return[{label:"Received",value:r(e.received,"red"),group:2}]}},p=class extends C{getSpecificLines(e,r){return[{label:"Expected",value:r(e.expected,"green"),group:2},{label:"Received",value:r(e.received,"red"),group:2}]}renderMatcherArgs(e){return e("(","darkGrey")+e(this.getExpectedPlaceholder(),"green")+e(")","darkGrey")}},S=class{render(e,r){let o=(a,i)=>r.colorize?h(a,i):a,n=[{label:"Error",value:this.renderErrorLine(e,r),group:1},{label:"At",value:o(e.executionContext.at||"unknown location","darkGrey"),group:1},{label:"Expected",value:o(e.expected,"green"),group:2},{label:"Received",value:o(e.received,"red"),group:2},{label:"Filename",value:o(e.executionContext.fileName,"darkGrey"),group:3},{label:"Line",value:o(e.executionContext.lineNumber.toString(),"darkGrey"),group:3}];return k.getFormatter(r.display).renderLines(n)}renderErrorLine(e,r){let o=(n,a)=>r.colorize?h(n,a):n;return o("expect(","darkGrey")+o("received","red")+o(").","darkGrey")+o(`${e.matcherName}`,"white")+o("(","darkGrey")+o("expected","green")+o(")","darkGrey")}},I=class{renderLines(e){let r=Math.max(...e.filter(o=>!o.raw).map(({label:o})=>(o+":").length));return`

`+e.map(({label:o,value:n,raw:a},i)=>{let c;if(a)c=n;else{let g=o+":";c=" ".repeat(r-g.length)+g+" "+n}let u=e[i+1];return u&&e[i].group!==u.group?c+`
`:c}).join(`
`)+`

`}},B=class{renderLines(e){return e.map(({label:r,value:o})=>{let n=typeof o=="string"&&o.includes(" ")?`"${o}"`:o;return`${r.toLowerCase().replace(/\s+/g,"_")}=${n}`}).join(" ")}},k=class{static formatters=new Map([["pretty",new I],["inline",new B]]);static getFormatter(e){let r=this.formatters.get(e);if(!r)throw new Error(`Unknown display format: ${e}`);return r}};function J(t,e){let r=e.assertFn??b;s.configure({colorize:e.colorize,display:e.display}),s.register("toBe",new S),s.register("toBeCloseTo",new M),s.register("toBeDefined",new T),s.register("toBeFalsy",new G),s.register("toBeGreaterThan",new P),s.register("toBeGreaterThanOrEqual",new _),s.register("toBeInstanceOf",new A),s.register("toBeLessThan",new F),s.register("toBeLessThanOrEqual",new D),s.register("toBeNaN",new $),s.register("toBeNull",new V),s.register("toBeTruthy",new H),s.register("toBeUndefined",new j),s.register("toEqual",new q),s.register("toHaveLength",new U);let o={usedAssert:r,isSoft:e.soft};return{toBe(n){l("toBe",()=>Object.is(t,n),n,t,o)},toBeCloseTo(n,a=2){let i=Math.pow(10,-a)*Math.max(Math.abs(t),Math.abs(n)),c=Math.abs(t-n);l("toBeCloseTo",()=>c<i,n,t,{...o,matcherSpecific:{precision:a,difference:c,expectedDifference:i}})},toBeDefined(){l("toBeDefined",()=>t!==void 0,"defined",JSON.stringify(t),o)},toBeFalsy(){l("toBeFalsy",()=>!t,"falsy",JSON.stringify(t),o)},toBeGreaterThan(n){l("toBeGreaterThan",()=>t>n,n,t,o)},toBeGreaterThanOrEqual(n){l("toBeGreaterThanOrEqual",()=>t>=n,n,t,o)},toBeInstanceOf(n){l("toBeInstanceOf",()=>t instanceof n,n.name,t.constructor.name,o)},toBeLessThan(n){l("toBeLessThan",()=>t<n,n,t,o)},toBeLessThanOrEqual(n){l("toBeLessThanOrEqual",()=>t<=n,n,t,o)},toBeNaN(){l("toBeNaN",()=>isNaN(t),"NaN",JSON.stringify(t),o)},toBeNull(){l("toBeNull",()=>t===null,"null",JSON.stringify(t),o)},toBeTruthy(){l("toBeTruthy",()=>!!t,"truthy",JSON.stringify(t),o)},toBeUndefined(){l("toBeUndefined",()=>t===void 0,"undefined",JSON.stringify(t),o)},toEqual(n){l("toEqual",()=>oe(t,n),JSON.stringify(n),JSON.stringify(t),o)},toHaveLength(n){l("toHaveLength",()=>t.length===n,n.toString(),t.length.toString(),o)}}}function l(t,e,r,o,{usedAssert:n,isSoft:a,matcherSpecific:i={}}){let c=fe(t,r,o,i);n(e(),s.getRenderer(t).render(c,s.getConfig()),a)}function fe(t,e,r,o={}){let n=w(new Error().stack),a=v(n);if(!a)throw new Error("k6 failed to capture execution context");return{executionContext:a,matcherName:t,expected:typeof e=="string"?e:JSON.stringify(e),received:JSON.stringify(r),matcherSpecific:o}}var M=class extends p{getMatcherName(){return"toBeCloseTo"}getSpecificLines(e,r){let o=e.matcherSpecific;return[{label:"Expected precision",value:r(o.precision.toString(),"green"),group:3},{label:"Expected difference",value:"< "+r(`${o.expectedDifference}`,"green"),group:3},{label:"Received difference",value:r(o.difference.toString(),"red"),group:3}]}renderMatcherArgs(e){return e("(","darkGrey")+e("expected","green")+e(", ","darkGrey")+e("precision","white")+e(")","darkGrey")}},T=class extends f{getMatcherName(){return"toBeDefined"}},G=class extends f{getMatcherName(){return"toBeFalsy"}},P=class extends p{getMatcherName(){return"toBeGreaterThan"}getSpecificLines(e,r){return[{label:"Expected",value:"> "+r(e.expected,"green"),group:3},{label:"Received",value:r(e.received,"red"),group:3}]}},_=class extends p{getMatcherName(){return"toBeGreaterThanOrEqual"}getSpecificLines(e,r){return[{label:"Expected",value:">= "+r(e.expected,"green"),group:3},{label:"Received",value:r(e.received,"red"),group:3}]}},A=class extends p{getMatcherName(){return"toBeInstanceOf"}getSpecificLines(e,r){return[{label:"Expected constructor",value:r(e.expected,"green"),group:3},{label:"Received constructor",value:r(e.received,"red"),group:3}]}},F=class extends p{getMatcherName(){return"toBeLessThan"}getSpecificLines(e,r){return[{label:"Expected",value:"< "+r(e.expected,"green"),group:3},{label:"Received",value:r(e.received,"red"),group:3}]}},D=class extends p{getMatcherName(){return"toBeLessThanOrEqual"}getSpecificLines(e,r){return[{label:"Expected",value:"<= "+r(e.expected,"green"),group:3},{label:"Received",value:r(e.received,"red"),group:3}]}},$=class extends f{getMatcherName(){return"toBeNaN"}},V=class extends f{getMatcherName(){return"toBeNull"}},H=class extends f{getMatcherName(){return"toBeTruthy"}},j=class extends f{getMatcherName(){return"toBeUndefined"}},q=class extends p{getMatcherName(){return"toEqual"}getSpecificLines(e,r){return[{label:"Expected",value:r(e.expected,"green"),group:3},{label:"Received",value:r(e.received,"red"),group:3}]}},U=class extends p{getMatcherName(){return"toHaveLength"}getSpecificLines(e,r){return[{label:"Expected length",value:r(e.expected,"green"),group:3},{label:"Received length",value:r(e.received,"red"),group:3},{label:"Received array",value:r(e.matcherSpecific?.receivedArray,"red"),group:3}]}};function oe(t,e){if(t===e)return!0;if(t===null||e===null||typeof t!="object"||typeof e!="object")return!1;let r=Object.keys(t),o=Object.keys(e);return r.length!==o.length?!1:r.every(n=>o.includes(n)&&oe(t[n],e[n]))}function te(t,e){let r=e.assertFn??b,o=e.soft??!1,n={timeout:e.timeout,interval:e.interval};s.configure({colorize:e.colorize,display:e.display}),s.register("toBeChecked",new K),s.register("toBeDisabled",new W),s.register("toBeEditable",new Y),s.register("toBeEnabled",new Z),s.register("toBeHidden",new Q),s.register("toBeVisible",new X),s.register("toHaveValue",new z);let a={locator:t,retryConfig:n,usedAssert:r,isSoft:o};return{async toBeChecked(i=n){await E("toBeChecked",async()=>await t.isChecked(),"checked","unchecked",{...a,options:i})},async toBeDisabled(i=n){await E("toBeDisabled",async()=>await t.isDisabled(),"disabled","enabled",{...a,options:i})},async toBeEditable(i=n){await E("toBeEditable",async()=>await t.isEditable(),"editable","uneditable",{...a,options:i})},async toBeEnabled(i=n){await E("toBeEnabled",async()=>await t.isEnabled(),"enabled","disabled",{...a,options:i})},async toBeHidden(i=n){await E("toBeHidden",async()=>await t.isHidden(),"hidden","visible",{...a,options:i})},async toBeVisible(i=n){await E("toBeVisible",async()=>await t.isVisible(),"visible","hidden",{...a,options:i})},async toHaveValue(i,c=n){let u=w(new Error().stack),g=v(u);if(!g)throw new Error("k6 failed to capture execution context");let d={executionContext:g,matcherName:"toHaveValue",expected:i,received:"unknown"};try{await ie(async()=>{let y=await t.inputValue();r(i===y,s.getRenderer("toHaveValue").render(d,s.getConfig()),o)},{...n,...c})}catch{r(!1,s.getRenderer("toHaveValue").render(d,s.getConfig()),o)}}}}function xe(t,e,r,o={}){let n=w(new Error().stack),a=v(n);if(!a)throw new Error("k6 failed to capture execution context");return{executionContext:a,matcherName:t,expected:e,received:r,...o}}async function E(t,e,r,o,{locator:n,retryConfig:a,usedAssert:i,isSoft:c,options:u={}}){let g=xe(t,r,o,{matcherSpecific:{locator:n,timeout:u.timeout}});try{await ie(async()=>{let d=await e();if(!d)throw new Error("matcher failed");i(d,s.getRenderer(t).render(g,s.getConfig()),c)},{...a,...u})}catch{i(!1,s.getRenderer(t).render(g,s.getConfig()),c)}}var m=class extends f{getMatcherName(){return`toBe${this.state[0].toUpperCase()}${this.state.slice(1)}`}getReceivedPlaceholder(){return"locator"}getSpecificLines(e,r){return[{label:"Expected",value:this.state,group:3},{label:"Received",value:this.oppositeState,group:3},{label:"Call log",value:"",group:3},{label:"",value:r(`  - expect.toBe${this.state[0].toUpperCase()}${this.state.slice(1)} with timeout ${e.matcherSpecific?.timeout}ms`,"darkGrey"),group:3,raw:!0},{label:"",value:r("  - waiting for locator","darkGrey"),group:3,raw:!0}]}},K=class extends m{state="checked";oppositeState="unchecked"},W=class extends m{state="disabled";oppositeState="enabled"},Y=class extends m{state="editable";oppositeState="uneditable"},Z=class extends m{state="enabled";oppositeState="disabled"},Q=class extends m{state="hidden";oppositeState="visible"},X=class extends m{state="visible";oppositeState="hidden"},z=class extends p{getMatcherName(){return"toHaveValue"}getSpecificLines(e,r){return[{label:"Expected",value:r(e.expected,"green"),group:3},{label:"Received",value:r(e.received,"red"),group:3},{label:"Call log",value:"",group:3},{label:"",value:r(`  - expect.toHaveValue with timeout ${e.matcherSpecific?.timeout}ms`,"darkGrey"),group:3,raw:!0},{label:"",value:r("  - waiting for locator","darkGrey"),group:3,raw:!0}]}};async function ie(t,e={}){let r=e.timeout??L.timeout,o=e.interval??L.interval,n=e._now??(()=>Date.now()),a=e._sleep??(c=>new Promise(u=>setTimeout(u,c))),i=n();for(;n()-i<r;){try{return await t(),!0}catch{}await a(o)}throw new ee(`Expect condition not met within ${r}ms timeout`)}var ee=class extends Error{constructor(e){super(e),this.name="RetryTimeoutError"}};var me=se();function se(t){let e=R.load(t);return Object.assign(function(r){return ae(r)?te(r,e):J(r,e)},{soft(r){return ae(r)?te(r,{...e,soft:!0}):J(r,{...e,soft:!0})},configure(r){return se(r)},get config(){return{...e}}})}function ae(t){if(!t||typeof t!="object")return!1;let e=["clear","isEnabled","isHidden","getAttribute","selectOption","press","type","dispatchEvent","dblclick","setChecked","isDisabled","focus","innerText","inputValue","check","isEditable","fill","textContent","hover","waitFor","click","uncheck","isChecked","isVisible","innerHTML","tap"],r=o=>e.every(n=>n in o);return t!=null&&typeof t=="object"&&r(t)}export{h as colorize,me as expect};
//# sourceMappingURL=index.js.map
