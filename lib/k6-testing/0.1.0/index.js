import pe from"k6/execution";function y(t,e,r){if(!t){if(r)throw new L(e);pe.test.abort(e)}}var L=class extends Error{constructor(e){super(e),this.name="AssertionFailedError"}};function ee(){return{...S,soft:!1,display:"pretty",colorize:!0,assertFn:y}}var S={timeout:5e3,interval:100};function v(t){if(!t||t.length<=1)return;let e=t[1],r=e.filePath,n=e.fileName,o=e.lineNumber,a=e.columnNumber,i=`${r}:${o}:${a}`;return{filePath:r,fileName:n,lineNumber:o,columnNumber:a,at:i}}function E(t){if(!t)return[];let e=t.split(`
`),r=[];for(let n=0;n<e.length;n++){let o=e[n].trim();if(n===0&&o.startsWith("Error")||!o.startsWith("at "))continue;o=o.slice(3).trim();let a="<anonymous>",i=o,c=o.indexOf("("),d=o.indexOf("file://");d===0?(a="<anonymous>",i=o.slice(d)):c>=0?(a=o.slice(0,c).trim()||"<anonymous>",i=o.slice(c+1,o.lastIndexOf(")")).trim()):i=o;let g=i.lastIndexOf("(");g>=0&&(i=i.slice(0,g)),i.startsWith("file://")&&(i=i.slice(7));let u=i.lastIndexOf(":");if(u===-1)continue;let m=i.lastIndexOf(":",u-1);if(m===-1)continue;let z=i.slice(0,m),ae=z.split("/").pop()??"",se=i.slice(m+1,u),ce=i.slice(u+1);r.push({functionName:a,filePath:z,fileName:ae,lineNumber:parseInt(se,10),columnNumber:parseInt(ce,10)})}return r}var te={reset:"\x1B[0m",black:"\x1B[30m",red:"\x1B[31m",green:"\x1B[32m",yellow:"\x1B[33m",blue:"\x1B[34m",magenta:"\x1B[35m",cyan:"\x1B[36m",white:"\x1B[37m",brightBlack:"\x1B[90m",brightRed:"\x1B[91m",brightGreen:"\x1B[92m",brightYellow:"\x1B[93m",brightBlue:"\x1B[94m",brightMagenta:"\x1B[95m",brightCyan:"\x1B[96m",brightWhite:"\x1B[97m",darkGrey:"\x1B[90m"};function h(t,e){return`${te[e]}${t}${te.reset}`}var s=class{static renderers=new Map;static config={colorize:!0,display:"pretty"};static register(e,r){this.renderers.set(e,r)}static getRenderer(e){return this.renderers.get(e)||new w}static configure(e){this.config={...this.config,...e}}static getConfig(){return this.config}},k=class{getReceivedPlaceholder(){return"received"}getExpectedPlaceholder(){return"expected"}renderErrorLine(e,r){let n=(o,a)=>r.colorize?h(o,a):o;return n("expect(","darkGrey")+n(this.getReceivedPlaceholder(),"red")+n(").","darkGrey")+n(this.getMatcherName(),"white")+this.renderMatcherArgs(n)}renderMatcherArgs(e){return e("()","darkGrey")}render(e,r){let n=(a,i)=>r.colorize?h(a,i):a,o=[{label:"Error",value:this.renderErrorLine(e,r),group:1},{label:"At",value:n(e.executionContext.at||"unknown location","darkGrey"),group:1},...this.getSpecificLines(e,n),{label:"Filename",value:n(e.executionContext.fileName,"darkGrey"),group:99},{label:"Line",value:n(e.executionContext.lineNumber.toString(),"darkGrey"),group:99}];return R.getFormatter(r.display).renderLines(o)}},f=class extends k{getSpecificLines(e,r){return[{label:"Received",value:r(e.received,"red"),group:2}]}},l=class extends k{getSpecificLines(e,r){return[{label:"Expected",value:r(e.expected,"green"),group:2},{label:"Received",value:r(e.received,"red"),group:2}]}renderMatcherArgs(e){return e("(","darkGrey")+e(this.getExpectedPlaceholder(),"green")+e(")","darkGrey")}},w=class{render(e,r){let n=(a,i)=>r.colorize?h(a,i):a,o=[{label:"Error",value:this.renderErrorLine(e,r),group:1},{label:"At",value:n(e.executionContext.at||"unknown location","darkGrey"),group:1},{label:"Expected",value:n(e.expected,"green"),group:2},{label:"Received",value:n(e.received,"red"),group:2},{label:"Filename",value:n(e.executionContext.fileName,"darkGrey"),group:3},{label:"Line",value:n(e.executionContext.lineNumber.toString(),"darkGrey"),group:3}];return R.getFormatter(r.display).renderLines(o)}renderErrorLine(e,r){let n=(o,a)=>r.colorize?h(o,a):o;return n("expect(","darkGrey")+n("received","red")+n(").","darkGrey")+n(`${e.matcherName}`,"white")+n("(","darkGrey")+n("expected","green")+n(")","darkGrey")}},N=class{renderLines(e){let r=Math.max(...e.filter(n=>!n.raw).map(({label:n})=>(n+":").length));return`

`+e.map(({label:n,value:o,raw:a},i)=>{let c;if(a)c=o;else{let g=n+":";c=" ".repeat(r-g.length)+g+" "+o}let d=e[i+1];return d&&e[i].group!==d.group?c+`
`:c}).join(`
`)+`

`}},C=class{renderLines(e){return e.map(({label:r,value:n})=>{let o=typeof n=="string"&&n.includes(" ")?`"${n}"`:n;return`${r.toLowerCase().replace(/\s+/g,"_")}=${o}`}).join(" ")}},R=class{static formatters=new Map([["pretty",new N],["inline",new C]]);static getFormatter(e){let r=this.formatters.get(e);if(!r)throw new Error(`Unknown display format: ${e}`);return r}};function q(t,e){let r=e.assertFn??y;s.configure({colorize:e.colorize,display:e.display}),s.register("toBe",new w),s.register("toBeCloseTo",new O),s.register("toBeDefined",new B),s.register("toBeFalsy",new I),s.register("toBeGreaterThan",new M),s.register("toBeGreaterThanOrEqual",new P),s.register("toBeInstanceOf",new G),s.register("toBeLessThan",new A),s.register("toBeLessThanOrEqual",new _),s.register("toBeNaN",new F),s.register("toBeNull",new T),s.register("toBeTruthy",new D),s.register("toBeUndefined",new $),s.register("toEqual",new H),s.register("toHaveLength",new V);let n={usedAssert:r,isSoft:e.soft};return{toBe(o){p("toBe",()=>Object.is(t,o),o,t,n)},toBeCloseTo(o,a=2){let i=Math.pow(10,-a)*Math.max(Math.abs(t),Math.abs(o)),c=Math.abs(t-o);p("toBeCloseTo",()=>c<i,o,t,{...n,matcherSpecific:{precision:a,difference:c,expectedDifference:i}})},toBeDefined(){p("toBeDefined",()=>t!==void 0,"defined",JSON.stringify(t),n)},toBeFalsy(){p("toBeFalsy",()=>!t,"falsy",JSON.stringify(t),n)},toBeGreaterThan(o){p("toBeGreaterThan",()=>t>o,o,t,n)},toBeGreaterThanOrEqual(o){p("toBeGreaterThanOrEqual",()=>t>=o,o,t,n)},toBeInstanceOf(o){p("toBeInstanceOf",()=>t instanceof o,o.name,t.constructor.name,n)},toBeLessThan(o){p("toBeLessThan",()=>t<o,o,t,n)},toBeLessThanOrEqual(o){p("toBeLessThanOrEqual",()=>t<=o,o,t,n)},toBeNaN(){p("toBeNaN",()=>isNaN(t),"NaN",JSON.stringify(t),n)},toBeNull(){p("toBeNull",()=>t===null,"null",JSON.stringify(t),n)},toBeTruthy(){p("toBeTruthy",()=>!!t,"truthy",JSON.stringify(t),n)},toBeUndefined(){p("toBeUndefined",()=>t===void 0,"undefined",JSON.stringify(t),n)},toEqual(o){p("toEqual",()=>re(t,o),JSON.stringify(o),JSON.stringify(t),n)},toHaveLength(o){p("toHaveLength",()=>t.length===o,o.toString(),t.length.toString(),n)}}}function p(t,e,r,n,{usedAssert:o,isSoft:a,matcherSpecific:i={}}){let c=le(t,r,n,i);o(e(),s.getRenderer(t).render(c,s.getConfig()),a)}function le(t,e,r,n={}){let o=E(new Error().stack),a=v(o);if(!a)throw new Error("k6 failed to capture execution context");return{executionContext:a,matcherName:t,expected:typeof e=="string"?e:JSON.stringify(e),received:JSON.stringify(r),matcherSpecific:n}}var O=class extends l{getMatcherName(){return"toBeCloseTo"}getSpecificLines(e,r){let n=e.matcherSpecific;return[{label:"Expected precision",value:r(n.precision.toString(),"green"),group:3},{label:"Expected difference",value:"< "+r(`${n.expectedDifference}`,"green"),group:3},{label:"Received difference",value:r(n.difference.toString(),"red"),group:3}]}renderMatcherArgs(e){return e("(","darkGrey")+e("expected","green")+e(", ","darkGrey")+e("precision","white")+e(")","darkGrey")}},B=class extends f{getMatcherName(){return"toBeDefined"}},I=class extends f{getMatcherName(){return"toBeFalsy"}},M=class extends l{getMatcherName(){return"toBeGreaterThan"}getSpecificLines(e,r){return[{label:"Expected",value:"> "+r(e.expected,"green"),group:3},{label:"Received",value:r(e.received,"red"),group:3}]}},P=class extends l{getMatcherName(){return"toBeGreaterThanOrEqual"}getSpecificLines(e,r){return[{label:"Expected",value:">= "+r(e.expected,"green"),group:3},{label:"Received",value:r(e.received,"red"),group:3}]}},G=class extends l{getMatcherName(){return"toBeInstanceOf"}getSpecificLines(e,r){return[{label:"Expected constructor",value:r(e.expected,"green"),group:3},{label:"Received constructor",value:r(e.received,"red"),group:3}]}},A=class extends l{getMatcherName(){return"toBeLessThan"}getSpecificLines(e,r){return[{label:"Expected",value:"< "+r(e.expected,"green"),group:3},{label:"Received",value:r(e.received,"red"),group:3}]}},_=class extends l{getMatcherName(){return"toBeLessThanOrEqual"}getSpecificLines(e,r){return[{label:"Expected",value:"<= "+r(e.expected,"green"),group:3},{label:"Received",value:r(e.received,"red"),group:3}]}},F=class extends f{getMatcherName(){return"toBeNaN"}},T=class extends f{getMatcherName(){return"toBeNull"}},D=class extends f{getMatcherName(){return"toBeTruthy"}},$=class extends f{getMatcherName(){return"toBeUndefined"}},H=class extends l{getMatcherName(){return"toEqual"}getSpecificLines(e,r){return[{label:"Expected",value:r(e.expected,"green"),group:3},{label:"Received",value:r(e.received,"red"),group:3}]}},V=class extends l{getMatcherName(){return"toHaveLength"}getSpecificLines(e,r){return[{label:"Expected length",value:r(e.expected,"green"),group:3},{label:"Received length",value:r(e.received,"red"),group:3},{label:"Received array",value:r(e.matcherSpecific?.receivedArray,"red"),group:3}]}};function re(t,e){if(t===e)return!0;if(t===null||e===null||typeof t!="object"||typeof e!="object")return!1;let r=Object.keys(t),n=Object.keys(e);return r.length!==n.length?!1:r.every(o=>n.includes(o)&&re(t[o],e[o]))}function Z(t,e){let r=e.assertFn??y,n=e.soft??!1,o={timeout:e.timeout,interval:e.interval};s.configure({colorize:e.colorize,display:e.display}),s.register("toBeChecked",new j),s.register("toBeDisabled",new J),s.register("toBeEditable",new U),s.register("toBeEnabled",new W),s.register("toBeHidden",new Y),s.register("toBeVisible",new K),s.register("toHaveValue",new Q);let a={locator:t,retryConfig:o,usedAssert:r,isSoft:n};return{async toBeChecked(i=o){await b("toBeChecked",async()=>await t.isChecked(),"checked","unchecked",{...a,options:i})},async toBeDisabled(i=o){await b("toBeDisabled",async()=>await t.isDisabled(),"disabled","enabled",{...a,options:i})},async toBeEditable(i=o){await b("toBeEditable",async()=>await t.isEditable(),"editable","uneditable",{...a,options:i})},async toBeEnabled(i=o){await b("toBeEnabled",async()=>await t.isEnabled(),"enabled","disabled",{...a,options:i})},async toBeHidden(i=o){await b("toBeHidden",async()=>await t.isHidden(),"hidden","visible",{...a,options:i})},async toBeVisible(i=o){await b("toBeVisible",async()=>await t.isVisible(),"visible","hidden",{...a,options:i})},async toHaveValue(i,c=o){let d=E(new Error().stack),g=v(d);if(!g)throw new Error("k6 failed to capture execution context");let u={executionContext:g,matcherName:"toHaveValue",expected:i,received:"unknown"};try{await ne(async()=>{let m=await t.inputValue();r(i===m,s.getRenderer("toHaveValue").render(u,s.getConfig()),n)},{...o,...c})}catch{r(!1,s.getRenderer("toHaveValue").render(u,s.getConfig()),n)}}}}function de(t,e,r,n={}){let o=E(new Error().stack),a=v(o);if(!a)throw new Error("k6 failed to capture execution context");return{executionContext:a,matcherName:t,expected:e,received:r,...n}}async function b(t,e,r,n,{locator:o,retryConfig:a,usedAssert:i,isSoft:c,options:d={}}){let g=de(t,r,n,{matcherSpecific:{locator:o,timeout:d.timeout}});try{await ne(async()=>{let u=await e();if(!u)throw new Error("matcher failed");i(u,s.getRenderer(t).render(g,s.getConfig()),c)},{...a,...d})}catch{i(!1,s.getRenderer(t).render(g,s.getConfig()),c)}}var x=class extends f{getMatcherName(){return`toBe${this.state[0].toUpperCase()}${this.state.slice(1)}`}getReceivedPlaceholder(){return"locator"}getSpecificLines(e,r){return[{label:"Expected",value:this.state,group:3},{label:"Received",value:this.oppositeState,group:3},{label:"Call log",value:"",group:3},{label:"",value:r(`  - expect.toBe${this.state[0].toUpperCase()}${this.state.slice(1)} with timeout ${e.matcherSpecific?.timeout}ms`,"darkGrey"),group:3,raw:!0},{label:"",value:r("  - waiting for locator","darkGrey"),group:3,raw:!0}]}},j=class extends x{state="checked";oppositeState="unchecked"},J=class extends x{state="disabled";oppositeState="enabled"},U=class extends x{state="editable";oppositeState="uneditable"},W=class extends x{state="enabled";oppositeState="disabled"},Y=class extends x{state="hidden";oppositeState="visible"},K=class extends x{state="visible";oppositeState="hidden"},Q=class extends l{getMatcherName(){return"toHaveValue"}getSpecificLines(e,r){return[{label:"Expected",value:r(e.expected,"green"),group:3},{label:"Received",value:r(e.received,"red"),group:3},{label:"Call log",value:"",group:3},{label:"",value:r(`  - expect.toHaveValue with timeout ${e.matcherSpecific?.timeout}ms`,"darkGrey"),group:3,raw:!0},{label:"",value:r("  - waiting for locator","darkGrey"),group:3,raw:!0}]}};async function ne(t,e={}){let r=e.timeout??S.timeout,n=e.interval??S.interval,o=e._now??(()=>Date.now()),a=e._sleep??(c=>new Promise(d=>setTimeout(d,c))),i=o();for(;o()-i<r;){try{return await t(),!0}catch{}await a(n)}throw new X(`Expect condition not met within ${r}ms timeout`)}var X=class extends Error{constructor(e){super(e),this.name="RetryTimeoutError"}};var ue=ie();function ie(t){let r={...ee(),...t};return Object.assign(function(n){return oe(n)?Z(n,r):q(n,r)},{soft(n){return oe(n)?Z(n,{...r,soft:!0}):q(n,{...r,soft:!0})},configure(n){return ie({...r,...n})}})}function oe(t){if(!t||typeof t!="object")return!1;let e=["clear","isEnabled","isHidden","getAttribute","selectOption","press","type","dispatchEvent","dblclick","setChecked","isDisabled","focus","innerText","inputValue","check","isEditable","fill","textContent","hover","waitFor","click","uncheck","isChecked","isVisible","innerHTML","tap"],r=n=>e.every(o=>o in n);return t!=null&&typeof t=="object"&&r(t)}export{h as colorize,ue as expect};
//# sourceMappingURL=index.js.map
